/*
 * jquery.tamper.js
 *  v 1.2
 *
 * Initial Author
 *  John Griffiths
 * 
 * Description
 *  Simply watches an element for changes, if any encountered flips the tamper flag to true.
 *  If the exit button is clicked and the tamper flag is set to true a dialog will appear warning 
 *  the user they will lose their changes if they click OK.
 * 
 * Params:
 *  watchName   : (required) element (textarea) to watch for changes
 *  exitName    : (required) element (button) which classes as an exit when clicked
 *  messageText : (optional) text to show in the alert dialog
 *
 *  PLEASE NOTE: if an onclick event is present on the exit element it will clone it, remove it 
 *  and append it so when the user click's ok it fires.
 *
 * Requires: jQuery v1.3+
 * 
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html 
 * 
 */
(function(a){a.fn.tamper=function(d,c){var e=a(this),b=a(d);c=c||"Are you sure? \nDoing so will lose any pending changes.";e.data("altered",false);b.data("tamper",{watch:this,message:c});if(typeof b.attr("onclick")=="function"){var h=b.attr("onclick");b.removeAttr("onclick")}e.keypress(function(){a(this).data("altered",true)});b.click(function(){var f=true,g=a(this).data("tamper").watch;if(g=a(g).data("altered")||false){var i=a(this).data("tamper").message;if(confirm(i)===false)f=false}f===true|g=== false&&h&&b.attr("onclick",h);return f})};a.fn.tamperAlert=function(d){var c=a(this);d=d||"Are you sure? \nDoing so will lose any pending changes.";c.data("tamper",{message:d});c.click(function(){var e=true,b=a(this).data("tamper").message;if(a(this).data("altered"))if(confirm(b)===false)e=false;return e})};a.fn.tamperFlag=function(){a(this).data("altered",true)}})(jQuery);